<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weakmap和 Weakset</title>
  </head>
  <body>
    <script>
      // Weakmap 和 Weakset

      // 1、WeakMap 只能以对象作为 key
      // const wMap = new WeakMap();
      // function fn() {
      //   const obj = { name: "zhangsan " };
      //   wMap.set(obj, "name info");
      //   console.log(wMap);
      // }

      // fn();
      // // 没有 forEach size 只有 has delete add
      // // gc  垃圾清理不一定是及时的

      // // WeakMap 使用场景
      // const userInfo = { name: "zhangsan " };
      // const cityInfo = { city: "beijing" };
      // // userInfo.city = cityInfo; // 不想直接简历联系
      // // 使用 WeakMap实现
      // wMap.set(userInfo, cityInfo); // 建立一种弱引用关系，而且两者保持独立，而且不影响垃圾清理机制
      // wMap.get(userInfo); // 如果后面不使用 city这个字段，那么后面一直是放不了cityInfo

      // 2、 WeakSet 只能以对象作为 value，没有 forEach、size，只能用 add delete has
      const wSet = new WeakSet();
      function fn() {
        const obj = { name: "zhangsan " };
        wSet.add(obj);
      }

      fn(); // set 内没有 obj 了

      // const set = new Set();
      // function fn() {
      //   const obj = { name: "zhangsan " };
      //   set.add(obj);
      // }

      // fn(); // set 内还有 obj

      // 如果 Set和 WeakSet 都存在时，不会被清理，WeakSet不会干扰Set 的引用
    </script>
  </body>
</html>
